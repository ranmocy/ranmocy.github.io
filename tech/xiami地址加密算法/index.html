<!DOCTYPE html><html class="borderbox"><head><title>Xiami地址加密算法</title><meta charset="utf-8" http-equiv="Content-Type" /><meta content="Ranmocy" name="author" /><meta content="Apr 13 2013" name="description" /><meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" /><link href="https://plus.google.com/+WanzhangSheng" rel="author" /><link href="https://plus.google.com/+WanzhangSheng" rel="publisher" /><link href="atom.xml" rel="alternate" title="Xiami地址加密算法" type="application/atom+xml" /><meta content="blog" property="og:type" /><meta content="Xiami地址加密算法" property="og:title" /><meta content="# Xiami 地址加密的算法    remain_str = &quot;hFaF4%52pt%m155E43t2i14E39pF.75261%fn68_1931e88121A.t%%779%x%227..." property="og:description" /><meta content="https://ranmocy.me/favicon.ico" property="og:image" /><meta content="summary" name="twitter:card" /><meta content="@ranmocy" name="twitter:site" /><meta content="Xiami地址加密算法" name="twitter:title" /><meta content="# Xiami 地址加密的算法    remain_str = &quot;hFaF4%52pt%m155E43t2i14E39pF.75261%fn68_1931e88121A.t%%779%x%227..." name="twitter:description" /><meta content="https://ranmocy.me/favicon.ico" name="twitter:image" /><meta content="@ranmocy" name="twitter:creator" /><meta content="https://ranmocy.me" name="twitter:domain" /><link href="/icons/favicon.ico" rel="icon" type="image/x-icon" /><link href="/icons/favicon.ico" rel="shortcut icon" type="image/x-icon" /><link href="/icons/Icon-60@2x.png" rel="apple-touch-icon" /><link href="/icons/Icon-60@3x.png" rel="apple-touch-icon" sizes="180x180" /><link href="/icons/Icon-76.png" rel="apple-touch-icon" sizes="76x76" /><link href="/icons/Icon-76@2x.png" rel="apple-touch-icon" sizes="152x152" /><link href="/icons/Icon-Small@2x.png" rel="apple-touch-icon" sizes="58x58" /><link href='/assets/stylesheets/default.css' media='screen' rel='stylesheet' type='text/css'></head><body><nav><span class="title"><a href='/' >Xiami地址加密算法</a></span><span class="date">Apr 13 2013</span><span class="link"><a href='/categories/' >Categories</a><a href='/memories/' >Memories</a><a href='/about/' >About</a></span></nav><main><article class="typo"><h1>Xiami 地址加密的算法</h1>

<pre><code>remain_str = "hFaF4%52pt%m155E43t2i14E39pF.75261%fn68_1931e88121A.t%%779%x%2274.2i2FF%_m"
store      = ["hFaF4%52p", "t%m155E43"]
store      = ["hFaF4%52p", "t%m155E43", "t2i14E39", "pF.75261", "%fn68_19", "31e88121", "A.t%%779", "%x%2274.", "2i2FF%_m"]
address    = "http%3A%2F%2Ff1.xiami.net%2F11768%2F454588%2F%5E2_177%5E361274_2491919.mp3"
address    = "http://f1.xiami.net/11768/454588/^2_177^361274_2491919.mp3"
address    = "http://f1.xiami.net/11768/454588/02_1770361274_2491919.mp3"



total      = location[0].to_i
remain_str = location[1..-1]
span       = (remain_str.length.to_f / total).floor
remainder  = remain_str.length % total
store       = []
address    = ""
# remain_str = "hFaF4%52pt%m155E43t2i14E39pF.75261%fn68_1931e88121A.t%%779%x%2274.2i2FF%_m"

remainder.times do |i|
  store[i] = remain_str[(span+1)*i...(span+1)*(i+1)]
end
# store      = ["hFaF4%52p", "t%m155E43"]

remainder.upto(total-1) do |i|
  index    = span*(i-remainder)+(span+1)*remainder
  length   = span
  store[i] = remain_str[index...index+length]
end
# store = ["hFaF4%52p", "t%m155E43", "t2i14E39", "pF.75261", "%fn68_19", "31e88121", "A.t%%779", "%x%2274.", "2i2FF%_m"]

# Take out every first char in store[i],
# Then take out every second char in store[i],
# Then cons together.
(span+1).times { |col| address &lt;&lt; store.collect { |row| row[col] }.join }
# address = "http%3A%2F%2Ff1.xiami.net%2F11768%2F454588%2F%5E2_177%5E361274_2491919.mp3"

# unEscape string
# address = "http://f1.xiami.net/11768/454588/^2_177^361274_2491919.mp3"
# address = "http://f1.xiami.net/11768/454588/02_1770361274_2491919.mp3"
address = CGI::unescape(address).gsub('^', '0')
</code></pre>
</article><div id="disqus_thread"><noscript><Please>enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.</Please></noscript></div><script>(function() {
var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true;
s.src = 'https://ranmocyblog.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date());
(document.head || document.body).appendChild(s);
})();</script></main><footer><div class="piece"><span>我努力将诸多人格中微小的片面拼合。</span><span>我拨开我的大脑，只为博君一笑。</span></div><div class="piece"><span>Created by: <a href='/about/' rel="author" title="Ranmocy">Ranmocy</a></span><span>Hosted at: <a href='https://github.com/ranmocy/Brain' rel="friend" title="Firebase" target="_blank">Firebase</a></span></div><div class="piece"><span>&copy;Copyright 1991-2020 Ranmocy.</span><span>All Rights Reserved.</span></div></footer><script>var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-20961770-4']); _gaq.push(['_trackPageview']); (function() {var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);})();</script></body></html>